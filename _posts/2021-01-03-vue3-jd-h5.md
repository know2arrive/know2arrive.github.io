---
layout:     post
title:      ä½¿ç”¨vue3.0.0å…¨å®¶æ¡¶é‡æ„vue2.6.1çš„ä¸€ä¸ªå•†åŸdemoï¼ğŸ”¥
subtitle:   vue3.0.0
date:       2021-1-3 22:03:16
author:     gankai
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - vue3å…¨å®¶æ¡¶
    - å¼€æºæ¡†æ¶
---

# vue3-jd-h5

åœ¨vueçš„Composition APIåˆšå‘å¸ƒçš„æ—¶å€™ï¼Œå†™äº†ä¸€ç¯‡[åŸºäºvue3.0.1 betaï¼Œæ­å»ºä»¿äº¬ä¸œçš„ç”µå•†H5é¡¹ç›®ï¼](https://juejin.cn/post/6844904146785533959)çš„æ–‡ç« ,ä»‹ç»äº†vueçš„ä¸€äº›æ–°ç‰¹æ€§ï¼Œå¦‚ä»Šæ­£å¼ç‰ˆæœ¬å·²ç»å‘å¸ƒäº†ï¼Œä»Šå¹´ä¹˜ç€æœ‰æ—¶é—´ï¼Œå¼€å§‹ä½¿ç”¨æœ€æ–°çš„vueå…¨å®¶æ¡¶æ¥è¿›è¡Œé‡æ„ï¼å…¶ä»–åŸºç¡€ä½¿ç”¨å°±ç›´æ¥ç•¥è¿‡äº†ï¼Œä¸æ‡‚çš„å¯ä»¥ç›´æ¥çœ‹[ä¸­æ–‡å®˜ç½‘](https://v3.cn.vuejs.org/)çš„ä¾‹å­æˆ–è€…æˆ‘[ä¹‹å‰é‚£ç¯‡æ–‡ç« ](https://juejin.cn/post/6844904146785533959)!

##  é¡¹ç›®ä»‹ç»

`vue3-jd-h5`æ˜¯ä¸€ä¸ªç”µå•†H5é¡µé¢å‰ç«¯é¡¹ç›®ï¼Œä»vue2.6.1è¿‡åº¦åˆ°vue3.0.0è¿›è¡Œé‡æ„ï¼ŒåŸºäº**Vue 3.0.0å…¨å®¶æ¡¶** â• **Vant 3.0.0** å®ç°ï¼

ğŸ“–æœ¬åœ°çº¿ä¸‹ä»£ç **vue2.6**åœ¨åˆ†æ”¯<a target='_blank' href='https://github.com/GitHubGanKai/vue-jd-h5/blob/demo/README.md'>demo</a>ä¸­ï¼Œä½¿ç”¨**mockjs**æ•°æ®è¿›è¡Œå¼€å‘ï¼Œæ•ˆæœå›¾è¯·ç‚¹å‡»ğŸ”—<a target='_blank' href='http://gankai.gitee.io/vue-jd-h5/index'>è¿™é‡Œ</a>

âš ï¸masteråˆ†æ”¯æ˜¯çº¿ä¸Šç”Ÿäº§ç¯å¢ƒä»£ç ï¼Œå› ä¸ºéƒ¨åˆ†åå°æ¥å£å·²ç»æŒ‚äº†ğŸ˜«ï¼Œå¯èƒ½æ— æ³•çœ‹åˆ°å®é™…æ•ˆæœã€‚

ğŸ“Œ æœ¬é¡¹ç›®è¿˜æœ‰å¾ˆå¤šä¸è¶³ä¹‹å¤„ï¼Œå¦‚æœæœ‰æƒ³ä¸ºæ­¤åšè´¡çŒ®çš„ä¼™ä¼´ï¼Œä¹Ÿæ¬¢è¿ç»™æˆ‘ä»¬æå‡ºPRï¼Œæˆ–è€…issue ï¼›

ğŸ”‘ æœ¬é¡¹ç›®æ˜¯å…è´¹å¼€æºçš„ï¼Œå¦‚æœæœ‰ä¼™ä¼´æƒ³è¦åœ¨æ¬¡åŸºç¡€ä¸Šè¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œå¯ä»¥cloneæˆ–è€…forkæ•´ä¸ªä»“åº“ï¼Œå¦‚æœèƒ½å¸®åŠ©åˆ°æ‚¨ï¼Œæˆ‘å°†æ„Ÿåˆ°éå¸¸é«˜å…´ï¼Œå¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªé¡¹ç›®ä¸é”™è¿˜è¯·ç»™ä¸ªstartï¼ğŸ™

## å¼€å§‹æ­å»º

1. é¦–å…ˆ,åœ¨æœ¬åœ°é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶ï¼Œå°†ä»£ç cloneåˆ°æœ¬åœ°ï¼š

```bash
git clone https://github.com/GitHubGanKai/vue-jd-h5.git 
```

2. ğŸ‘‰åˆ‡æ¢åˆ°åˆ†æ”¯**vue-next**å¼€å§‹è¿›è¡Œä½“éªŒï¼ˆç›®å‰æ­£åœ¨é€æ­¥é‡æ„ä¸­ï¼‰ï¼ğŸ‘ˆ

3. åœ¨ IDEA å‘½ä»¤è¡Œä¸­è¿è¡Œå‘½ä»¤ï¼š`npm install`ä¸‹è½½å®‰è£…ç›¸å…³ä¾èµ–;

## å®‰è£…vueå…¨å®¶æ¡¶

### é…ç½®å®‰è£…`vue-router`

```javascript
// src/router/index.js
import { createRouter, createWebHistory } from 'vue-router'

const indexRouter = {
  path: '/',
  component: () => import('@/views/index'),
  redirect: '/index',
  children: []
}

const routes = [
  indexRouter,
  {
    path: '/nopermission',
    name: 'nopermission',
    meta: {
      index: 1
    },
    component: () => import('@/views/error/NoPermission')
  },
  {
    path: '/*',
    name: '404',
    meta: {
      index: 1
    },
    component: () => import('@/views/error/404')
  },
]

const routerContext = require.context('./modules', true, /\.js$/)
routerContext.keys().forEach(route => {
  const routerModule = routerContext(route)
  indexRouter.children = [...indexRouter.children, ...(routerModule.default || routerModule)]
})

export default createRouter({
  history: createWebHistory(process.env.BASE_URL),
  routes
})

```

#### ä½¿ç”¨`useRouter`hookså¯ä»¥è·å–è·¯ç”±å¯¹è±¡ï¼š

```javascript
import { onMounted } from "vue";
import { useRouter, useRoute } from "vue-router";

export default {
  name: "home",
  setup(props, context) {

    const $router = useRouter();
    
    const handleClick = id => {
      $router.push(`/classify/product/${id}`);
    };

    return {
      handleClick,
    };
  }
};

```

#### ä½¿ç”¨`useRoute`è·å–è·¯ç”±å‚æ•°å¯¹è±¡

```javascript
import { onMounted } from "vue";
import { useRoute } from "vue-router";

export default {
  name: "home",
  setup(props, context) {
	
    // å¯ä»¥æ‹¿åˆ°æ‰€æœ‰å’Œè·¯ç”±ç›¸å…³çš„å‚æ•°
    // å’ŒuseRouter()å°±å·®ä¸€ä¸ªå­—æ¯rï¼ŒğŸ˜…
    const $route = useRoute(); 
    
     onMounted(async () => {
      const { data } = await ctx.$http.get(
        `http://test.happymmall.com/product/${$route.params.id}`
      );
    });

    return {
      $route,
    };
  }
};
```

### é…ç½®å®‰è£…vuex

```javascript
// src/store/index.js
import { createStore } from 'vuex'

import cart from './modules/cart'
import search from './modules/search'

export default createStore({
  modules: {
    cart,
    search
  },
  strict: process.env.NODE_ENV !== 'production'
})

```

åœ¨æ–‡ä»¶ä¸­ä½¿ç”¨å¦‚ä¸‹ï¼š
```javascript
import { useStore } from "vuex";
import { reactive, getCurrentInstance } from "vue";

setup(props, context) {
    const { ctx } = getCurrentInstance();
    const $store = useStore();
    // ctx.$store === $store  ==>true å…¶å®æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼
    
    const ball = reactive({
      show: false,
      el: ""
    });

    const addToCart = (event, tag) => {
      $store.commit("cart/addToCart", tag);
      ball.show = true;
      ball.el = event.target;
    };

    return {
      ...toRefs(ball),
      addToCart,
    };
  }
```

åœ¨å…¥å£æ–‡ä»¶`main.js`ä¸­ä½¿ç”¨ï¼š

```javascript
import { createApp } from 'vue'
import App from './App.vue'
import router from './router'
import store from './store'
import 'lib-flexible/flexible'

import Vant from 'vant'
import 'vant/lib/index.css' // å…¨å±€å¼•å…¥æ ·å¼

const app = createApp(App);
app.use(Vant).use(store).use(router).mount('#app');
```

###  ä½¿ç”¨`svg-sprite-loader`å¤„ç†svgæ–‡ä»¶

é¦–å…ˆåœ¨`vue.config.js`ä¸­é…ç½®`svg-sprite-loader`:

```
module.exports = {
   chainWebpack: config => {
    const svgRule = config.module.rule("svg");
    svgRule.uses.clear();
    svgRule
      .use("svg-sprite-loader")
      .loader("svg-sprite-loader")
      .options({
        symbolId: "icon-[name]"
      })
      .end();
  },
}
```

åœ¨`src/components/SvgIcon/index.vue`ä¸­:

```javascript
import { computed, toRefs, toRef } from "vue";
export default {
  name: "svg-icon",
  props: {
    iconClass: {
      type: String,
      required: true
    },
    className: {
      type: String
    }
  },
  setup(initProps) {
    // const { iconClass } = initProps;âŒ
    // å› ä¸º props æ˜¯å“åº”å¼çš„ï¼Œä½ ä¸èƒ½ä½¿ç”¨ ES6 è§£æ„ï¼Œå› ä¸ºå®ƒä¼šæ¶ˆé™¤ prop çš„å“åº”æ€§ã€‚
    // å¦‚æœéœ€è¦è§£æ„ propï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ setup å‡½æ•°ä¸­çš„ toRefs æ¥å®Œæˆæ­¤æ“ä½œï¼š
    const { iconClass } = toRefs(initProps);
    const iconName = computed(() => {
      return `#icon-${iconClass.value}`;
    });

    // ç”±äº className æ˜¯å¯é€‰çš„ propï¼Œåˆ™ä¼ å…¥çš„ props ä¸­å¯èƒ½æ²¡æœ‰ className ã€‚
    // åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒtoRefs å°†ä¸ä¼šä¸º className åˆ›å»ºä¸€ä¸ª ref ï¼Œéœ€è¦ä½¿ç”¨ toRef æ›¿ä»£å®ƒã€‚
    const className = toRef(initProps, "className");
    const svgClass = computed(() => {
      if (className) {
        return "svg-icon " + className.value;
      } else {
        return "svg-icon";
      }
    });
    return {
      iconName,
      svgClass
    };
  }
};
```

å°†è¿™ä¸ªå†™æˆä¸€ä¸ªæ’ä»¶ï¼Œç»Ÿä¸€å°†æ‰€æœ‰çš„svgæ–‡ä»¶æ³¨å†Œæˆç»„ä»¶çš„å½¢å¼æ–¹ä¾¿å…¨å±€ä½¿ç”¨ï¼

```javascript
// src/icons/index.js
import SvgIcon from '@/components/SvgIcon'

const requireAll = requireContext => requireContext.keys().map(requireContext)

export default {
  install(app) {
    app.component('svg-icon', SvgIcon);
    const req = require.context('./svgs/', false, /\.svg$/)
    requireAll(req)
  }
}
```

### ç»Ÿä¸€æ³¨å†Œæ‰€æœ‰ç»„ä»¶

åœ¨`src/components/index.js`æ–‡ä»¶ä¸­ï¼š
```javascript
function capitalizeFirstLetter(str) {
  return str.charAt(0).toUpperCase() + str.slice(1)
}

function validateFileName(str) {
  return /^\S+\.vue$/.test(str) &&
    str.replace(/^\S+\/(\w+)\.vue$/, (rs, $1) => capitalizeFirstLetter($1))
}

const requireComponent = require.context('.', true, /\.vue$/)

export default {
  install(app) {
    requireComponent.keys().forEach(filePath => {
      const componentConfig = requireComponent(filePath)
      const fileName = validateFileName(filePath)
      const componentName = fileName.toLowerCase() === 'index' ?
        capitalizeFirstLetter(componentConfig.default.name) :
        fileName
      app.component(componentName, componentConfig.default || componentConfig)
    })
  }
}
function capitalizeFirstLetter(str) {
  return str.charAt(0).toUpperCase() + str.slice(1)
}

function validateFileName(str) {
  return /^\S+\.vue$/.test(str) &&
    str.replace(/^\S+\/(\w+)\.vue$/, (rs, $1) => capitalizeFirstLetter($1))
}
const requireComponent = require.context('.', true, /\.vue$/)
export default {
  install(app) {
    requireComponent.keys().forEach(filePath => {
      const componentConfig = requireComponent(filePath)
      const fileName = validateFileName(filePath)
      const componentName = fileName.toLowerCase() === 'index' ?
        capitalizeFirstLetter(componentConfig.default.name) :
        fileName
      app.component(componentName, componentConfig.default || componentConfig)
    })
  }
}
```

### é…ç½®å…¨å±€`axios`å°è£…å¼‚æ­¥è¯·æ±‚ï¼š

```javascript
// src/plugins/axios.js
import axios from 'axios'
import router from '../router/index'
import { Toast } from 'vant'
const tip = msg => {
  Toast({
    message: msg,
    duration: 1000,
    forbidClick: true
  })
}
const errorHandle = (status, other) => {
  switch (status) {
    case 401:
      toLogin()
      break
    case 403:
      tip('ç™»å½•è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•')
      localStorage.removeItem('token')
      setTimeout(() => {
        toLogin()
      }, 1000)
      break
    case 404:
      tip('è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨')
      break
    default:
      console.log(other)
  }
}
const instance = axios.create({
  baseURL: process.env.VUE_APP_BASE_URL,
  // baseURL: '',
  timeout: 1000 * 12
})
instance.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=UTF-8'
instance.interceptors.request.use(
  config => {
    const token = localStorage.token
    token && (config.headers.token = token)
    return config
  },
  error => Promise.error(error))

// å“åº”æ‹¦æˆªå™¨
instance.interceptors.response.use(
  // è¯·æ±‚æˆåŠŸ
  response => {
    return response.status === 200 ? Promise.resolve(response) : Promise.reject(response)
  },
  // è¯·æ±‚å¤±è´¥
  error => {
    const {
      response
    } = error
    if (response) {
      // è¯·æ±‚å·²å‘å‡ºï¼Œä½†æ˜¯ä¸åœ¨2xxçš„èŒƒå›´
      errorHandle(response.status, response.data.message)
      return Promise.reject(response)
    }
  })

export default {
  install(app) {
    // è¿™å¯ä»¥ä»£æ›¿ Vue 2.x Vue.prototype åœ¨å•æ–‡ä»¶ä¸­ï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š
    // const { ctx } = getCurrentInstance();
    // ctx.$httpè®¿é—®
    app.config.globalProperties.$http = instance
  }
};
```
###  å°è£…å…¨å±€eventBus

åœ¨` 2.x `ä¸­ï¼Œ`Vue` å®ä¾‹å¯ç”¨äºè§¦å‘ç”±äº‹ä»¶è§¦å‘ API é€šè¿‡æŒ‡ä»¤å¼æ–¹å¼æ·»åŠ çš„å¤„ç†å‡½æ•° ($onï¼Œ$off å’Œ $once)ã€‚è¿™å¯ä»¥åˆ›å»º event hubï¼Œç”¨æ¥åˆ›å»ºåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å¯ç”¨çš„å…¨å±€äº‹ä»¶ç›‘å¬å™¨ï¼š

```javascript
// src/utils/eventBus.js

const eventBus = new Vue()

export default eventBus
```

`3.x`ä»å®ä¾‹ä¸­å®Œå…¨ç§»é™¤äº† `$on`ã€`$off` å’Œ `$once` æ–¹æ³•ã€‚`$emit` ä»ç„¶åŒ…å«äºç°æœ‰çš„ API ä¸­ï¼Œå› ä¸ºå®ƒç”¨äºè§¦å‘ç”±çˆ¶ç»„ä»¶å£°æ˜å¼æ·»åŠ çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚
å¯ä»¥ä½¿ç”¨å®ç°äº†äº‹ä»¶è§¦å‘æ¥å£çš„å¤–éƒ¨åº“æ¥æ›¿æ¢ç°æœ‰çš„ event hubï¼Œä¾‹å¦‚ `mitt` æˆ– `tiny-emitter`ã€‚

æ‰€ä»¥éœ€è¦åœ¨`2.x`çš„åŸºç¡€ä¸Šè¿›è¡Œè‡ªæˆ‘æ”¹é€ (æ²¡æœ‰ä½¿ç”¨ `mitt` æˆ– `tiny-emitter`):

```javascript
import { getCurrentInstance } from 'vue'

class EventBus {
  constructor(app) {
    if (!this.handles) {
      Object.defineProperty(this, 'handles', {
        value: {},
        enumerable: false
      })
    }
    this.app = app
    // _uidå’ŒEventNameçš„æ˜ å°„
    this.eventMapUid = {}
  }
  setEventMapUid(uid, eventName) {
    if (!this.eventMapUid[uid]) {
      this.eventMapUid[uid] = []
    }
    this.eventMapUid[uid].push(eventName)
    // æŠŠæ¯ä¸ª_uidè®¢é˜…çš„äº‹ä»¶åå­—pushåˆ°å„è‡ªuidæ‰€å±çš„æ•°ç»„é‡Œ
  }
  $on(eventName, callback, vm) {
    // vmæ˜¯åœ¨ç»„ä»¶å†…éƒ¨ä½¿ç”¨æ—¶ç»„ä»¶å½“å‰çš„thisç”¨äºå–_uid
    if (!this.handles[eventName]) {
      this.handles[eventName] = []
    }
    this.handles[eventName].push(callback)
    this.setEventMapUid(vm._uid, eventName)
  }
  $emit() {
    let args = [...arguments]
    let eventName = args[0]
    let params = args.slice(1)
    if (this.handles[eventName]) {
      let len = this.handles[eventName].length
      for (let i = 0; i < len; i++) {
        this.handles[eventName][i](...params)
      }
    }
  }
  $offVmEvent(uid) {
    let currentEvents = this.eventMapUid[uid] || []
    currentEvents.forEach(event => {
      this.$off(event)
    })
  }
  $off(eventName) {
    delete this.handles[eventName]
  }
}

let $EventBus = {}
$EventBus.install = (app) => {
  app.config.globalProperties.$eventBus = new EventBus(app)
  app.mixin({
    beforeUnmount() {
      const currentInstance = getCurrentInstance();
      // æ‹¦æˆªbeforeUnmounté’©å­,è‡ªåŠ¨é”€æ¯è‡ªèº«æ‰€æœ‰è®¢é˜…çš„äº‹ä»¶
      this.$eventBus.$offVmEvent(currentInstance._uid)
    }
  })
}
export default $EventBus
```

åœ¨`src/views/classify/index.vue`æ–‡ä»¶ä¸­ä½¿ç”¨å¦‚ä¸‹ï¼š

```javascript
import ListScroll from "@/components/scroll/ListScroll";
import { ref, reactive, onMounted, toRefs, getCurrentInstance } from "vue";
import { useRouter } from "vue-router";

export default {
  name: "classify",
  components: {
    ListScroll
  },
  setup(props) {
    
    const { ctx } = getCurrentInstance();
    const $router = useRouter();

    const searchWrap = ref(null);

    const state = reactive({
      categoryDatas: [],
      currentIndex: 0
    });

    const selectMenu = index => {
      state.currentIndex = index;
    };

    const setSearchWrapHeight = () => {
      const { clientHeight } = document.documentElement;
      searchWrap.value.style.height = clientHeight - 100 + "px";
    };

    const selectProduct = sku => {
      $router.push({ path: "/classify/recommend", query: { sku } });
    };

    onMounted(async () => {
      setSearchWrapHeight();
      // ä½¿ç”¨å…¨å±€æ³¨è¿‡çš„$eventBus
      ctx.$eventBus.$emit("changeTag", 1);
      // ä½¿ç”¨å…¨å±€æ³¨å†Œè¿‡çš„$http
      const { data } = await ctx.$http.get(
        "http://test.happymmall.com/category/categoryData"
      );
      const { categoryData } = data;
      state.categoryDatas = categoryData;
    });

    return {
      searchWrap,
      ...toRefs(state),
      selectProduct,
      selectMenu
    };
  }
};
```
### å°è£…ä¸ªç®€å•çš„hooksï¼š`useClickOutside`

```javascript
// src/hooks/useClickOutside.js
import { onMounted, onUnmounted, ref } from "vue";

export default useClickOutSide = (domRef) => {
  const isOutside = ref(false);

  const handler = (event) => {
    if (domRef.value) {
      if (domRef.value.contains(event.target)) {
        isOutside.value = false;
      } else {
        isOutside.value = true;
      }
    }
  }

  onMounted(() => {
    document.addEventListener('click', handler);
  });

  onUnmounted(() => {
    document.removeEventListener('click', handler);
  });

  return isOutside;
}
```

### ä½¿ç”¨ this
åœ¨ `setup()` å†…éƒ¨ï¼Œ`this` ä¸ä¼šæ˜¯è¯¥æ´»è·ƒå®ä¾‹çš„å¼•ç”¨ï¼Œå› ä¸º `setup()` æ˜¯åœ¨è§£æå…¶å®ƒç»„ä»¶é€‰é¡¹ä¹‹å‰è¢«è°ƒç”¨çš„ï¼Œæ‰€ä»¥ `setup()` å†…éƒ¨çš„ `this` çš„è¡Œä¸ºä¸å…¶å®ƒé€‰é¡¹ä¸­çš„ `this` å®Œå…¨ä¸åŒã€‚è¿™åœ¨å’Œå…¶å®ƒé€‰é¡¹å¼ `API` ä¸€èµ·ä½¿ç”¨ `setup()` æ—¶å¯èƒ½ä¼šå¯¼è‡´æ··æ·†ã€‚

å¯ä»¥é€šè¿‡`getCurrentInstance`è·å–å½“å‰å•ä¸ªæ–‡ä»¶ç»„ä»¶çš„å®ä¾‹ï¼ŒåŒæ—¶`ctx`ä¸Šé¢æŒ‚åœ¨äº†ä¸€äº›å…¨å±€å±æ€§:
```javascript
import { getCurrentInstance,  onMounted, reactive, toRefs } from 'vue'

export default {
  name: "classify",
  setup(props) {
    const { ctx } = getCurrentInstance();
    
    const state = reactive({
      categoryDatas: [],
      currentIndex: 0
    });
    
    onMounted(async () => {
      const { data } = await ctx.$http.get("http://test.happymmall.com/category/categoryData");
      const { categoryData, page } = data;
      state.categoryDatas = categoryData;
      state.currentIndex = page;
    });
    
    return {
      ...toRefs(state)
    };
  }
};
```

### ğŸ“¦ å°è£…better-scroll

```javascript
<template>
  <div ref="wrapper" class="scroll-wrapper">
    <slot></slot>
  </div>
</template>
<script>
import BScroll from "better-scroll";
import { onMounted, nextTick, ref, watchEffect } from "vue";
export default {
  props: {
    probeType: {
      type: Number,
      default: 1
    },
    click: {
      type: Boolean,
      default: true
    },
    scrollX: {
      type: Boolean,
      default: false
    },
    listenScroll: {
      type: Boolean,
      default: false
    },
    scrollData: {
      type: Array,
      default: null
    },
    pullup: {
      type: Boolean,
      default: false
    },
    pulldown: {
      type: Boolean,
      default: false
    },
    beforeScroll: {
      type: Boolean,
      default: false
    },
    refreshDelay: {
      type: Number,
      default: 20
    }
  },
  setup(props, setupContext) {
    const wrapper = ref(null);

    const initScroll = () => {
      if (!wrapper.value) return;
      const scroll = new BScroll(wrapper.value, {
        probeType: props.probeType,
        click: props.click,
        scrollX: props.scrollX
      });
      // æ˜¯å¦æ´¾å‘æ»šåŠ¨äº‹ä»¶
      if (props.listenScroll) {
        scroll.on("scroll", pos => {
          setupContext.emit("scroll", pos);
        });
      }
      // æ˜¯å¦æ´¾å‘æ»šåŠ¨åˆ°åº•éƒ¨äº‹ä»¶ï¼Œç”¨äºä¸Šæ‹‰åŠ è½½
      if (props.pullup) {
        scroll.on("scrollEnd", () => {
          // æ»šåŠ¨åˆ°åº•éƒ¨
          if (scroll.y <= scroll.maxScrollY + 50) {
            setupContext.emit("scrollToEnd");
          }
        });
      }
      // æ˜¯å¦æ´¾å‘é¡¶éƒ¨ä¸‹æ‹‰äº‹ä»¶ï¼Œç”¨äºä¸‹æ‹‰åˆ·æ–°
      if (props.pulldown) {
        scroll.on("touchend", pos => {
          // ä¸‹æ‹‰åŠ¨ä½œ
          if (pos.y > 50) {
            setupContext.emit("pulldown");
          }
        });
      }
      // æ˜¯å¦æ´¾å‘åˆ—è¡¨æ»šåŠ¨å¼€å§‹çš„äº‹ä»¶
      if (props.beforeScroll) {
        scroll.on("beforeScrollStart", () => {
          setupContext.emit("beforeScroll");
        });
      }
    };
    const disable = () => {
      // ä»£ç†better-scrollçš„disableæ–¹æ³•
      scroll?.disable();
    };
    const enable = () => {
      // ä»£ç†better-scrollçš„enableæ–¹æ³•
      scroll?.enable();
    };
    const refresh = () => {
      // ä»£ç†better-scrollçš„refreshæ–¹æ³•
      scroll?.refresh();
    };
    const scrollTo = () => {
      // ä»£ç†better-scrollçš„scrollToæ–¹æ³•
      scroll?.scrollTo.apply(scroll, arguments);
    };
    const scrollToElement = () => {
      // ä»£ç†better-scrollçš„scrollToElementæ–¹æ³•
      scroll?.scrollToElement.apply(scroll, arguments);
    };
    onMounted(() => {
      nextTick(() => {
        initScroll();
      });
    });
    return {};
  }
};
</script>
<style lang="scss" type="text/scss" scoped>
.scroll-wrapper {
  width: 100%;
  height: 100%;
  overflow: hidden;
  overflow-y: scroll;
}
</style>

```

## æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚
ç”±äºæ—¶é—´å…³ç³»å…ˆå†™åˆ°è¿™é‡Œäº†ï¼Œæ˜å¤©è¿˜è¦ä¸Šç­ï¼Œè¿™ä¸ªé¡¹ç›®ä»…ä»…åªæ˜¯ç”¨æ¥ç»ƒä¹ vue3ç”¨çš„å°demoï¼Œé‡Œé¢è¿˜æœ‰éƒ¨åˆ†çš„ğŸ›ï¼Œéšæ—¶æ¬¢è¿å„ä½å°ä¼™ä¼´æå‡ºåˆ†äº«æ„è§ï¼githubä»£ç ç‚¹å‡»[è¿™é‡Œ](https://github.com/GitHubGanKai/vue3-jd-h5)ã€‚

â¤ï¸ çœ‹å®Œä¸‰ä»¶äº‹:
å¦‚æœä½ è§‰å¾—è¿™ç¯‡å†…å®¹å¯¹ä½ æŒºæœ‰å¯å‘ï¼Œæˆ‘æƒ³é‚€è¯·ä½ å¸®æˆ‘ä¸ªå°å¿™ï¼š</p>
<ol data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; list-style-type: decimal; font-size: 15px; color: #595959;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;">ç‚¹èµï¼Œè®©æ›´å¤šçš„äººä¹Ÿèƒ½çœ‹åˆ°è¿™ç¯‡å†…å®¹ï¼Œä¹Ÿæ–¹ä¾¿è‡ªå·±éšæ—¶æ‰¾åˆ°è¿™ç¯‡å†…å®¹ï¼ˆæ”¶è—ä¸ç‚¹èµï¼Œéƒ½æ˜¯è€æµæ°“ -_-ï¼‰ï¼›</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;">å…³æ³¨æˆ‘ä»¬ï¼Œä¸å®šæœŸåˆ†å¥½æ–‡ç« ï¼›</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; font-size: 14px; font-weight: normal; color: #595959;">ä¹Ÿçœ‹çœ‹å…¶å®ƒæ–‡ç« ï¼›</section></li></ol>
<p data-tool="mdniceç¼–è¾‘å™¨" style="padding-top: 8px; padding-bottom: 8px; line-height: 26px; color: #2b2b2b; margin: 10px 0px; letter-spacing: 2px; font-size: 14px; word-spacing: 2px;">ğŸ‰æ¬¢è¿ä½ æŠŠè‡ªå·±çš„å­¦ä¹ ä½“ä¼šå†™åœ¨ç•™è¨€åŒºï¼Œä¸æˆ‘å’Œå…¶ä»–åŒå­¦ä¸€èµ·è®¨è®ºã€‚å¦‚æœä½ è§‰å¾—æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿æŠŠæ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p>


